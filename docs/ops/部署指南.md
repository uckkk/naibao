# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### å‰ææ¡ä»¶

- âœ… æœåŠ¡å™¨å·²å‡†å¤‡ï¼š`<SSH_HOST>`
- âœ… å·²å®‰è£…SSHå®¢æˆ·ç«¯
- âœ… æœ¬åœ°å·²å®‰è£…Goï¼ˆç”¨äºç¼–è¯‘ï¼Œå¯é€‰ï¼‰
- âœ… å·²é…ç½®æœ¬æœºç§æœ‰è¿æ¥ä¿¡æ¯ï¼š`scripts/.env.local`ï¼ˆå‚è€ƒ `scripts/.env.example`ï¼‰

---

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³•1ï¼šä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/stonem2/Documents/AiCode/naibao

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
./scripts/deploy.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
- å®‰è£…ä¾èµ–
- åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
- ç¼–è¯‘å’Œå¯åŠ¨æœåŠ¡ï¼ˆå¯é€‰ï¼‰

---

### æ–¹æ³•2ï¼šæ‰‹åŠ¨éƒ¨ç½²

#### æ­¥éª¤1ï¼šè¿æ¥æœåŠ¡å™¨

```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST>
```

#### æ­¥éª¤2ï¼šåˆå§‹åŒ–æœåŠ¡å™¨ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰

```bash
# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
bash <(curl -s https://raw.githubusercontent.com/your-repo/naibao/main/scripts/server_init.sh)

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
cd /opt/naibao
./scripts/server_init.sh
```

#### æ­¥éª¤3ï¼šä¸Šä¼ ä»£ç 

åœ¨æœ¬åœ°æ‰§è¡Œï¼š

```bash
# ä¸Šä¼ åç«¯ä»£ç 
scp -r backend <SSH_USER>@<SSH_HOST>:/opt/naibao/

# ä¸Šä¼ æ•°æ®åº“è„šæœ¬
scp -r database <SSH_USER>@<SSH_HOST>:/opt/naibao/
```

#### æ­¥éª¤4ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨æœåŠ¡å™¨ä¸Šï¼š

```bash
# è¿›å…¥åç«¯ç›®å½•
cd /opt/naibao/backend

# åˆ›å»º.envæ–‡ä»¶
nano .env
```

é…ç½®å†…å®¹ï¼š

```env
SERVER_PORT=8080
GIN_MODE=release

DB_HOST=localhost
DB_PORT=5432
DB_USER=naibao_user
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
DB_NAME=naibao
DB_SSLMODE=disable

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

JWT_SECRET=ä½ çš„JWTå¯†é’¥ï¼ˆè‡³å°‘32ä½ï¼‰
```

#### æ­¥éª¤5ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
# å¯¼å…¥è¡¨ç»“æ„
psql -U naibao_user -d naibao -f /opt/naibao/database/schema.sql

# å¯¼å…¥åˆå§‹åŒ–æ•°æ®
psql -U naibao_user -d naibao -f /opt/naibao/database/init_data.sql
```

#### æ­¥éª¤6ï¼šç¼–è¯‘å’Œè¿è¡Œ

```bash
# è¿›å…¥åç«¯ç›®å½•
cd /opt/naibao/backend

# å®‰è£…ä¾èµ–
go mod download

# ç¼–è¯‘
go build -o naibao-server main.go

# æµ‹è¯•è¿è¡Œ
./naibao-server
```

å¦‚æœçœ‹åˆ° `Server starting on :8080`ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼

#### æ­¥éª¤7ï¼šé…ç½®systemdæœåŠ¡ï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
nano /etc/systemd/system/naibao.service
```

å†…å®¹ï¼š

```ini
[Unit]
Description=Naibao Backend Server
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/naibao/backend
ExecStart=/opt/naibao/backend/naibao-server
Restart=always
RestartSec=10
Environment="GIN_MODE=release"

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡è½½systemd
systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
systemctl start naibao

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable naibao

# æŸ¥çœ‹çŠ¶æ€
systemctl status naibao
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥åç«¯æœåŠ¡
systemctl status naibao

# æ£€æŸ¥PostgreSQL
systemctl status postgresql

# æ£€æŸ¥Redis
systemctl status redis
```

### 2. æµ‹è¯•API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# åº”è¯¥è¿”å›: {"status":"ok"}
```

### 3. æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æœåŠ¡æ—¥å¿—
journalctl -u naibao -f

# æˆ–æŸ¥çœ‹æ–‡ä»¶æ—¥å¿—
tail -f /opt/naibao/backend/logs/app.log
```

---

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### é‡å¯æœåŠ¡

```bash
systemctl restart naibao
```

### åœæ­¢æœåŠ¡

```bash
systemctl stop naibao
```

### æŸ¥çœ‹æ—¥å¿—

```bash
journalctl -u naibao -f
```

### æ›´æ–°ä»£ç 

```bash
# 1. åœæ­¢æœåŠ¡
systemctl stop naibao

# 2. ä¸Šä¼ æ–°ä»£ç 
# (åœ¨æœ¬åœ°æ‰§è¡Œ)
scp -r backend <SSH_USER>@<SSH_HOST>:/opt/naibao/

# 3. åœ¨æœåŠ¡å™¨ä¸Šé‡æ–°ç¼–è¯‘
cd /opt/naibao/backend
go build -o naibao-server main.go

# 4. å¯åŠ¨æœåŠ¡
systemctl start naibao
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

```bash
# ä¿®æ”¹æ•°æ®åº“å¯†ç 
sudo -u postgres psql
ALTER USER naibao_user WITH PASSWORD 'æ–°å¯†ç ';
\q
```

### 2. é…ç½®é˜²ç«å¢™

```bash
# åªå…è®¸å¿…è¦çš„ç«¯å£
ufw allow 22/tcp    # SSH
ufw allow 8080/tcp  # åç«¯APIï¼ˆå¦‚æœéœ€è¦å¤–ç½‘è®¿é—®ï¼‰
ufw enable
```

### 3. ä½¿ç”¨HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

å»ºè®®ä½¿ç”¨Nginxåå‘ä»£ç†ï¼Œé…ç½®SSLè¯ä¹¦ã€‚

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
journalctl -u naibao -n 50

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tulpn | grep 8080
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -U naibao_user -d naibao -c "SELECT 1;"
```

### é—®é¢˜3ï¼šç«¯å£æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥é˜²ç«å¢™
ufw status

# æ£€æŸ¥æœåŠ¡æ˜¯å¦ç›‘å¬
netstat -tulpn | grep 8080
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆ
- [ ] PostgreSQLå®‰è£…å¹¶è¿è¡Œ
- [ ] Rediså®‰è£…å¹¶è¿è¡Œï¼ˆå¯é€‰ï¼‰
- [ ] ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] æœåŠ¡å·²ç¼–è¯‘
- [ ] systemdæœåŠ¡å·²é…ç½®
- [ ] æœåŠ¡å·²å¯åŠ¨
- [ ] APIæµ‹è¯•é€šè¿‡
- [ ] é˜²ç«å¢™å·²é…ç½®

---

**éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ `http://<API_HOST>:8080` è®¿é—®APIï¼** ğŸ‰
