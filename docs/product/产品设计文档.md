# 纯奶粉喂养APP - 产品设计文档

## 🎯 核心战略定位

**目标**：垂直赛道，极致体验，最低定价，建立技术壁垒，让大厂抄不起

---

## 📐 一、奶量计算算法设计

### 1.1 计算公式

#### **主要算法：按体重计算**
```
标准日均奶量 = 体重(kg) × 标准系数(ml/kg)

标准系数范围：
- 最小值：120 ml/kg/天
- 推荐值：135 ml/kg/天（取中间值）
- 最大值：150 ml/kg/天

单次推荐奶量 = 标准日均奶量 ÷ 今日剩余喂养次数
```

#### **参考：按月龄（卫健委标准）**
```
月龄参考标准：
- 0-1个月：600-700ml/天
- 1-3个月：700-900ml/天
- 3-6个月：800-1000ml/天
- 6-12个月：900-1100ml/天
```

### 1.2 动态调整逻辑

```
已摄入量 = 今日已喂养的所有奶量总和
剩余次数 = 根据当前时间计算到今日结束前的预计喂养次数
剩余标准量 = 标准日均奶量 - 已摄入量

如果剩余次数 > 0:
    单次推荐量 = 剩余标准量 ÷ 剩余次数
    单次推荐量 = max(最小值, min(单次推荐量, 最大值))
    最小值 = 50ml（避免推荐过小）
    最大值 = 200ml（单次合理上限）
else:
    单次推荐量 = 标准单次量（使用用户偏好或默认）

预警逻辑：
- 超喂预警：如果已摄入量 > 标准日均奶量 × 1.2（超出20%）
- 不足预警：如果已摄入量 < 标准日均奶量 × 0.8（低于80%）
- 正常：绿色提示
- 接近上限：黄色提示
```

### 1.3 显示逻辑

**弹窗展示内容：**
```
主显示：
├─ 推荐奶量：XXX ml（大号加粗）
├─ 参考范围：XX-XX ml/天（小字灰色）
├─ 今日已摄入：XXX ml / 标准 XXX ml
├─ 剩余喂养次数：X次
└─ 预警提示（如有）：
   ├─ 正常：✅ 喂养量正常
   ├─ 不足：⚠️ 今日奶量偏低，建议增加
   └─ 超量：⚠️ 今日奶量偏高，建议减少
```

---

## 🎨 二、一键投喂交互设计

### 2.1 交互流程

```
用户点击"投喂"按钮
    ↓
弹出奶量选择弹窗（显示默认推荐量）
    ↓
用户操作方式：
   A. 直接点击"确认"（使用默认推荐量，0额外操作）
   B. 快速调整（±10ml、±20ml、±50ml按钮）
   C. 手动输入（点击输入框，精确输入）
    ↓
保存记录 → 更新总奶量 → 重置倒计时
```

### 2.2 弹窗UI设计

```
┌─────────────────────────────┐
│  推荐奶量                     │
│  150 ml      [大号加粗显示]    │
│                             │
│  参考范围：700-900 ml/天      │
│  [小字灰色，显示月龄标准]      │
│                             │
│  今日已摄入：440 ml / 810 ml │
│  [进度条显示]                │
│                             │
│  剩余喂养次数：4次           │
│                             │
│  [如有预警，显示提示]         │
│                             │
│  快速调整：                  │
│  [-50] [-20] [-10] [+10] [+20] [+50]
│                             │
│  或手动输入：[______] ml     │
│                             │
│  [取消]  [确认投喂]          │
└─────────────────────────────┘
```

### 2.3 用户偏好记忆

**记忆维度：**
1. **默认奶量偏好**：用户常用的单次奶量（如：用户经常选择150ml，则下次默认显示150ml）
2. **调整习惯**：用户是否习惯增加/减少（如：用户习惯+20ml，则下次自动+20ml后再显示）
3. **输入方式偏好**：用户更常用哪种方式（A/B/C）

**记忆规则：**
- 记录最近10次的用户选择
- 计算平均值和模式，作为下次默认值
- 如果用户连续3次使用相同奶量，则将该值设为默认
- 如果用户每次都调整（如总是+20ml），则在推荐值基础上自动调整

---

## 💻 三、技术架构设计

### 3.1 架构概览

```
前端（移动端 Flutter）
    ↓ (WebSocket/HTTP长轮询)
后端API服务器（Go + Gin）
    ↓
实时同步服务（WebSocket服务器）
    ↓
数据库集群（腾讯云TDSQL-C PostgreSQL + Redis）
```

### 3.2 关键技术选型

#### **前端：Flutter（已确认）**
- **理由：** UI体验最佳，动画流畅（60fps），组件丰富
- **技术栈：**
  - Flutter 3.x
  - 状态管理：Riverpod
  - 本地存储：sqflite
  - 网络：dio
  - WebSocket：web_socket_channel

#### **后端：Go + Gin（已确认）**
- **理由：** 性能极佳，并发能力强，适合实时同步
- **技术栈：**
  - Go 1.21+
  - Web框架：Gin
  - WebSocket：gorilla/websocket
  - 数据库ORM：GORM

#### **实时同步**
- **WebSocket**（主要）+ HTTP长轮询（降级）
  - 使用：Gorilla WebSocket（Go）

#### **数据库：腾讯云TDSQL-C PostgreSQL（已确认）**
- **主数据库**：PostgreSQL 15+（腾讯云托管）
  - 优势：响应快，性价比高（¥350/月）
- **缓存层**：Redis 7+（实时数据、会话）
- **文件存储**：腾讯云COS（图片、头像）

#### **成本优势**
- 初期成本：约¥800/月（包含服务器、数据库、存储、CDN）
- 比AWS/Azure便宜约50%，国内访问速度快

### 3.3 性能优化策略

#### **无延时感设计**

1. **本地优先策略**
   ```
   用户操作 → 立即本地更新UI → 后台同步到服务器
   （用户无感知，即使网络慢也不影响体验）
   ```

2. **离线支持**
   - 本地SQLite存储所有数据
   - 上线后自动同步差异
   - 冲突解决：服务器时间戳优先

3. **数据预加载**
   - 首页数据优先加载
   - 历史数据按需分页加载
   - 预加载今日数据到缓存

4. **智能推送**
   - 使用WebSocket推送更新
   - 心跳检测（30秒），自动重连
   - 降级方案：HTTP长轮询（5秒间隔）

5. **缓存策略**
   ```
   用户数据：
   - 实时数据：Redis（TTL: 5分钟）
   - 历史数据：本地SQLite + 云端PostgreSQL
   
   计算缓存：
   - 奶量计算结果缓存1小时
   - 用户偏好数据本地缓存
   ```

### 3.4 成本优化

#### **服务器成本控制**

**初期方案（0-1万用户）：**
- 服务器：2核4G × 2台（主备，约¥200/月）
- 数据库：云数据库RDS（基础版，约¥300/月）
- 存储：OSS（按量，约¥50/月）
- CDN：按量，约¥100/月
- **总计：约¥750/月**

**优化策略：**
1. **冷热数据分离**
   - 热数据（最近7天）：Redis + 主数据库
   - 冷数据（7天前）：归档到对象存储

2. **定时任务优化**
   - 数据统计计算：凌晨批量处理
   - 历史数据清理：30天前数据压缩归档

3. **CDN加速**
   - 静态资源（图片、头像）：CDN分发
   - API响应：智能路由，就近访问

### 3.5 多设备同步设计

#### **同步协议**

```
数据结构：
{
  userId: "user123",
  deviceId: "device456",
  timestamp: 1699000000000,
  operation: "create" | "update" | "delete",
  dataType: "feeding" | "babyInfo" | "settings",
  data: {...},
  version: 1  // 乐观锁，解决冲突
}
```

#### **冲突解决**
1. **时间戳优先**：最后写入获胜（Last Write Wins）
2. **操作合并**：相同时间戳，合并操作（如：同时增加奶量，累加）
3. **用户确认**：冲突严重时，提示用户选择

#### **实时推送**
```
设备A操作 → WebSocket推送到服务器 → 服务器广播到设备B/C/D
（延迟 < 100ms）
```

---

## 💰 四、定价策略设计

### 4.1 功能分层

#### **免费版**
```
✅ 基础记录功能
✅ 单宝宝管理
✅ 数据统计（最近30天）
✅ 智能推荐奶量
✅ 单设备使用
❌ 首页底部广告位（小横幅，不影响核心功能）
```

#### **付费版（68元终身 / 18元/月）**
```
✅ 所有免费版功能
✅ 免广告
✅ 多宝宝管理（不限数量）
✅ 多设备同步（不限设备）
✅ 多角色协作（家庭账号共享）
✅ 无限历史数据
✅ 数据导出（PDF报告）
✅ 高级数据分析
```

### 4.2 广告策略

**位置**：首页底部（不影响核心操作）
- 尺寸：320×50（标准横幅）
- 内容：奶粉品牌推广（CPS分成）
- 展示频率：每次打开首页显示1次，5秒后可关闭
- 不影响：一键投喂、数据查看等核心功能

**收益预估**：
- 点击率：2-5%
- 转化率：1-3%
- 单次点击收益：¥0.5-2元
- 10万用户日活50%：5万次展示 × 3%点击率 = 1500次点击 × ¥1 = ¥1500/天 = ¥4.5万/月

### 4.3 定价逻辑

**为什么68元终身？**
1. **降低决策门槛**：一次性付费，无需持续决策
2. **高LTV**：终身用户，长期价值更高
3. **建立壁垒**：用户付费后粘性高，大厂难以迁移
4. **口碑传播**：超值定价，容易形成口碑

**为什么18元/月？**
1. **给用户选择**：不喜欢一次性付费的用户
2. **现金流**：持续收入
3. **年费折扣**：可考虑年费优惠（如¥180/年，相当于15元/月）

---

## 📋 五、实施计划

### Phase 1: MVP核心功能（4-6周）

**Week 1-2：基础架构**
- [ ] 技术栈选型确认
- [ ] 项目初始化
- [ ] 数据库设计
- [ ] API接口设计
- [ ] WebSocket实时同步搭建

**Week 3-4：核心功能开发**
- [ ] 宝宝基础资料管理
- [ ] 一键投喂功能
- [ ] 奶量计算算法实现
- [ ] 喂养记录存储和展示
- [ ] 倒计时功能

**Week 5-6：数据统计和优化**
- [ ] 数据统计页面
- [ ] 多设备同步测试
- [ ] 性能优化
- [ ] 用户偏好记忆功能

### Phase 2: 体验优化（2-3周）

**Week 7-8：交互优化**
- [ ] 弹窗交互优化（A/B/C三种方式）
- [ ] 动画和过渡效果
- [ ] 离线支持完善
- [ ] 错误处理和提示优化

**Week 9：测试和修复**
- [ ] 多设备同步测试
- [ ] 性能压测
- [ ] Bug修复
- [ ] 用户体验测试

### Phase 3: 商业化功能（2周）

**Week 10-11：付费功能**
- [ ] 支付集成（微信/支付宝）
- [ ] 广告位开发（免费版）
- [ ] 会员功能开发（付费版）
- [ ] 功能权限控制

**Week 12：上线准备**
- [ ] 内测
- [ ] 应用商店上架准备
- [ ] 运营准备

---

## 🔒 六、竞争壁垒设计

### 6.1 技术壁垒

1. **极致性能**
   - 本地优先，0延时感
   - 智能算法，精准推荐
   - 大厂难以投入同样资源优化

2. **数据积累**
   - 用户喂养数据积累
   - 算法不断优化（基于真实数据）
   - 形成数据护城河

### 6.2 成本壁垒

1. **超低定价**
   - 68元终身，大厂无法匹敌
   - 靠广告+CPS维持运营
   - 大厂复制成本高，ROI低

2. **垂直专注**
   - 不做社交、不做内容
   - 只做工具，成本可控
   - 大厂做综合平台，成本高

### 6.3 用户壁垒

1. **数据迁移成本**
   - 用户数据沉淀在平台
   - 切换成本高
   - 形成用户锁定

2. **使用习惯**
   - 极致体验养成习惯
   - 用户满意度高
   - 口碑传播

---

## 📊 七、关键指标

### 7.1 产品指标
- DAU（日活用户）
- 喂养记录完成率
- 用户留存率（次日/7日/30日）
- 平均使用时长

### 7.2 技术指标
- API响应时间（P95 < 200ms）
- WebSocket连接成功率（>99%）
- 同步延迟（<100ms）
- 崩溃率（<0.1%）

### 7.3 商业指标
- 免费转付费转化率（目标：5-10%）
- 广告点击率
- 用户LTV（生命周期价值）
- 月收入

---

## 🎯 下一步行动

**等待确认的事项：**
1. ✅ 技术栈选型（Go vs Node.js？Flutter vs React Native？）
2. ✅ 数据库选型（PostgreSQL vs MongoDB？）
3. ✅ 实施优先级调整
4. ✅ 其他特殊需求

**确认后开始：**
- 搭建项目架构
- 实现核心算法
- 开发MVP版本

---

**文档版本**：v1.0  
**创建时间**：2025年1月  
**最后更新**：2025年1月

