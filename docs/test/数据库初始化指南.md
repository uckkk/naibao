# æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/setup_db.sh

# 2. è¿è¡Œè„šæœ¬
./scripts/setup_db.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
- âœ… åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ… å¯¼å…¥è¡¨ç»“æ„ï¼ˆschema.sqlï¼‰
- âœ… å¯¼å…¥åˆå§‹åŒ–æ•°æ®ï¼ˆinit_data.sqlï¼‰
- âœ… éªŒè¯æ•°æ®

---

## ğŸ“‹ æ–¹æ³•2ï¼šæ‰‹åŠ¨æ‰§è¡Œï¼ˆæœ¬åœ°æ•°æ®åº“ï¼‰

### æ­¥éª¤1ï¼šè¿æ¥åˆ° PostgreSQL

```bash
# ä½¿ç”¨ postgres ç”¨æˆ·è¿æ¥
psql -U postgres

# æˆ–è€…å¦‚æœåˆ›å»ºäº†ä¸“ç”¨ç”¨æˆ·
psql -U naibao_user -d naibao
```

### æ­¥éª¤2ï¼šåˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

```sql
-- åœ¨ psql ä¸­æ‰§è¡Œ
CREATE DATABASE naibao;
\q
```

### æ­¥éª¤3ï¼šå¯¼å…¥è¡¨ç»“æ„

```bash
# æ–¹å¼Aï¼šä½¿ç”¨ psql å‘½ä»¤ï¼ˆæ¨èï¼‰
psql -U postgres -d naibao -f database/schema.sql

# æ–¹å¼Bï¼šåœ¨ psql ä¸­æ‰§è¡Œ
psql -U postgres -d naibao
\i database/schema.sql
\q
```

### æ­¥éª¤4ï¼šå¯¼å…¥åˆå§‹åŒ–æ•°æ®

```bash
# æ–¹å¼Aï¼šä½¿ç”¨ psql å‘½ä»¤ï¼ˆæ¨èï¼‰
psql -U postgres -d naibao -f database/init_data.sql

# æ–¹å¼Bï¼šåœ¨ psql ä¸­æ‰§è¡Œ
psql -U postgres -d naibao
\i database/init_data.sql
\q
```

### æ­¥éª¤5ï¼šéªŒè¯æ•°æ®

```bash
# è¿æ¥åˆ°æ•°æ®åº“
psql -U postgres -d naibao

# æ£€æŸ¥è¡¨æ•°é‡
SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';

# æ£€æŸ¥å«å¥å§”æ ‡å‡†æ•°æ®
SELECT COUNT(*) FROM health_standards;

# æ£€æŸ¥å¥¶ç²‰å“ç‰Œæ•°æ®
SELECT COUNT(*) FROM formula_brands;

# é€€å‡º
\q
```

---

## ğŸŒ æ–¹æ³•3ï¼šè¿œç¨‹æœåŠ¡å™¨æ•°æ®åº“

### å¦‚æœæ•°æ®åº“åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Š

```bash
# æ–¹å¼Aï¼šé€šè¿‡ SSH æ‰§è¡Œ
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "psql -U naibao_user -d naibao -f /path/to/schema.sql"

# æ–¹å¼Bï¼šå…ˆä¸Šä¼ æ–‡ä»¶ï¼Œå†æ‰§è¡Œ
# 1. ä¸Šä¼  SQL æ–‡ä»¶åˆ°æœåŠ¡å™¨
scp -P <SSH_PORT> database/schema.sql <SSH_USER>@<SSH_HOST>:/tmp/
scp -P <SSH_PORT> database/init_data.sql <SSH_USER>@<SSH_HOST>:/tmp/

# 2. SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST>

# 3. åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
psql -U naibao_user -d naibao -f /tmp/schema.sql
psql -U naibao_user -d naibao -f /tmp/init_data.sql
```

### å¦‚æœä½¿ç”¨äº‘æ•°æ®åº“ï¼ˆå¦‚è…¾è®¯äº‘ï¼‰

```bash
# 1. ä¸‹è½½äº‘æ•°æ®åº“çš„è¿æ¥å·¥å…·æˆ–ä½¿ç”¨ psql
# 2. ä½¿ç”¨äº‘æ•°æ®åº“æä¾›çš„è¿æ¥ä¿¡æ¯

# ç¤ºä¾‹ï¼ˆéœ€è¦æ›¿æ¢ä¸ºå®é™…å€¼ï¼‰
psql -h your-db-host.com -U naibao_user -d naibao -f database/schema.sql
psql -h your-db-host.com -U naibao_user -d naibao -f database/init_data.sql
```

---

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ° psql å‘½ä»¤

**macOS**:
```bash
# ä½¿ç”¨ Homebrew å®‰è£…
brew install postgresql@15

# æ·»åŠ åˆ° PATHï¼ˆå¦‚æœä½¿ç”¨ Homebrewï¼‰
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"
```

**Linux**:
```bash
# Ubuntu/Debian
sudo apt install postgresql-client

# CentOS/RHEL
sudo yum install postgresql
```

### é—®é¢˜2ï¼šè¿æ¥è¢«æ‹’ç»

```bash
# æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
# macOS
brew services list | grep postgresql

# Linux
sudo systemctl status postgresql

# å¯åŠ¨æœåŠ¡
# macOS
brew services start postgresql@15

# Linux
sudo systemctl start postgresql
```

### é—®é¢˜3ï¼šè®¤è¯å¤±è´¥

```bash
# æ–¹å¼1ï¼šä½¿ç”¨ postgres ç”¨æˆ·ï¼ˆé»˜è®¤ï¼‰
psql -U postgres

# æ–¹å¼2ï¼šä¿®æ”¹ pg_hba.conf å…è®¸æœ¬åœ°è¿æ¥
# ç¼–è¾‘ /etc/postgresql/14/main/pg_hba.conf
# å°† local all all æ”¹ä¸º trust æˆ– md5
```

### é—®é¢˜4ï¼šæƒé™ä¸è¶³

```sql
-- åœ¨ psql ä¸­æ‰§è¡Œï¼ˆä½¿ç”¨ postgres ç”¨æˆ·ï¼‰
GRANT ALL PRIVILEGES ON DATABASE naibao TO naibao_user;
\c naibao
GRANT ALL ON SCHEMA public TO naibao_user;
```

### é—®é¢˜5ï¼šè¡¨å·²å­˜åœ¨é”™è¯¯

```sql
-- å¦‚æœéœ€è¦é‡æ–°åˆ›å»ºï¼Œå…ˆåˆ é™¤æ•°æ®åº“
DROP DATABASE naibao;
CREATE DATABASE naibao;

-- ç„¶åé‡æ–°å¯¼å…¥
```

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼ˆæœ¬åœ°å¼€å‘ï¼‰

```bash
# 1. ç¡®ä¿ PostgreSQL è¿è¡Œ
brew services start postgresql@15  # macOS
# æˆ–
sudo systemctl start postgresql    # Linux

# 2. åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
psql -U postgres -c "CREATE DATABASE naibao;"

# 3. å¯¼å…¥è¡¨ç»“æ„
psql -U postgres -d naibao -f database/schema.sql

# 4. å¯¼å…¥åˆå§‹åŒ–æ•°æ®
psql -U postgres -d naibao -f database/init_data.sql

# 5. éªŒè¯
psql -U postgres -d naibao -c "SELECT COUNT(*) FROM formula_brands;"
```

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼ˆæœåŠ¡å™¨ï¼‰

```bash
# 1. SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST>

# 2. ä¸Šä¼  SQL æ–‡ä»¶ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
scp -P <SSH_PORT> database/schema.sql <SSH_USER>@<SSH_HOST>:/tmp/
scp -P <SSH_PORT> database/init_data.sql <SSH_USER>@<SSH_HOST>:/tmp/

# 3. åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆSSH è¿æ¥åï¼‰
psql -U naibao_user -d naibao -f /tmp/schema.sql
psql -U naibao_user -d naibao -f /tmp/init_data.sql

# 4. éªŒè¯
psql -U naibao_user -d naibao -c "SELECT COUNT(*) FROM formula_brands;"
```

---

## âœ… éªŒè¯æ¸…å•

æ‰§è¡Œå®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

- [ ] æ•°æ®åº“ `naibao` å·²åˆ›å»º
- [ ] æ‰€æœ‰è¡¨å·²åˆ›å»ºï¼ˆçº¦ 15+ ä¸ªè¡¨ï¼‰
- [ ] `health_standards` è¡¨æœ‰æ•°æ®ï¼ˆå«å¥å§”æ ‡å‡†ï¼‰
- [ ] `formula_brands` è¡¨æœ‰ 12 æ¡å“ç‰Œæ•°æ®
- [ ] `feeding_settings` è¡¨å·²åˆ›å»ºï¼ˆæ–°æ·»åŠ çš„è¡¨ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåï¼š

1. **é…ç½®åç«¯ç¯å¢ƒå˜é‡**ï¼ˆ`backend/.env`ï¼‰ï¼š
```env
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres  # æˆ– naibao_user
DB_PASSWORD=your_password
DB_NAME=naibao
DB_SSLMODE=disable
```

2. **å¯åŠ¨åç«¯æœåŠ¡**ï¼š
```bash
cd backend
go run main.go
```

3. **æµ‹è¯• API**ï¼š
```bash
curl http://localhost:8080/health
```

---

**æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼** ğŸ‰
