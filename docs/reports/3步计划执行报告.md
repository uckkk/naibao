# 3æ­¥è®¡åˆ’æ‰§è¡ŒæŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### âœ… æ­¥éª¤1: é…ç½®åç«¯ç¯å¢ƒå˜é‡

**å·²å®Œæˆ**ï¼š
- âœ… åœ¨æœåŠ¡å™¨åˆ›å»ºäº† `.env` æ–‡ä»¶
- âœ… é…ç½®äº†æ•°æ®åº“è¿æ¥ï¼ˆlocalhost PostgreSQLï¼‰
- âœ… é…ç½®äº†JWTå¯†é’¥
- âœ… é…ç½®äº†æœåŠ¡å™¨ç«¯å£ï¼ˆ8080ï¼‰

**é…ç½®æ–‡ä»¶ä½ç½®**: `/opt/naibao/backend/.env`

---

### âœ… æ­¥éª¤2: å¯åŠ¨åç«¯æœåŠ¡

**å·²å®Œæˆ**ï¼š
- âœ… å®‰è£…äº†Go 1.21.5
- âœ… é…ç½®äº†Goä»£ç†ï¼ˆä½¿ç”¨å›½å†…é•œåƒ goproxy.cnï¼‰
- âœ… ä¸Šä¼ äº†åç«¯ä»£ç 
- âœ… ä¸‹è½½äº†Goä¾èµ–åŒ…
- âœ… ä¿®å¤äº†Rediså¯é€‰ä¾èµ–é—®é¢˜
- âœ… ç¼–è¯‘äº†åç«¯æœåŠ¡ï¼ˆnaibao-serverï¼‰
- âœ… æœåŠ¡å·²åœ¨åå°å¯åŠ¨

**æœåŠ¡ä¿¡æ¯**ï¼š
- **å¯æ‰§è¡Œæ–‡ä»¶**: `/opt/naibao/backend/naibao-server`
- **æ—¥å¿—æ–‡ä»¶**: `/opt/naibao/backend/server.log`
- **PIDæ–‡ä»¶**: `/opt/naibao/backend/server.pid`
- **ç®¡ç†è„šæœ¬**: 
  - `start_server.sh` - å¯åŠ¨æœåŠ¡
  - `stop_server.sh` - åœæ­¢æœåŠ¡

---

### âœ… æ­¥éª¤3: æµ‹è¯•æœåŠ¡

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… æœåŠ¡è¿›ç¨‹è¿è¡Œä¸­
- âœ… ç«¯å£8080å·²ç›‘å¬
- âœ… å¥åº·æ£€æŸ¥APIå“åº”æ­£å¸¸
- âœ… æ³¨å†Œæ¥å£æµ‹è¯•æˆåŠŸ
- âœ… ç™»å½•æ¥å£æµ‹è¯•æˆåŠŸ
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸

---

## ğŸ¯ æœåŠ¡çŠ¶æ€

### å½“å‰çŠ¶æ€
- **æœåŠ¡åœ°å€**: `http://<API_HOST>:8080`
- **å¥åº·æ£€æŸ¥**: `http://<API_HOST>:8080/health`
- **APIåŸºç¡€è·¯å¾„**: `http://<API_HOST>:8080/api`

### å·²éªŒè¯çš„API
- âœ… `GET /health` - å¥åº·æ£€æŸ¥
- âœ… `POST /api/public/register` - ç”¨æˆ·æ³¨å†Œ
- âœ… `POST /api/public/login` - ç”¨æˆ·ç™»å½•

---

## ğŸ“ æœåŠ¡ç®¡ç†

### å¯åŠ¨æœåŠ¡
```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "cd /opt/naibao/backend && ./start_server.sh"
```

### åœæ­¢æœåŠ¡
```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "cd /opt/naibao/backend && ./stop_server.sh"
```

### æŸ¥çœ‹æ—¥å¿—
```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "tail -f /opt/naibao/backend/server.log"
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "ps aux | grep naibao-server"
```

---

## ğŸ”§ é…ç½®systemdæœåŠ¡ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å¼€æœºè‡ªå¯ï¼Œå¯ä»¥åˆ›å»ºsystemdæœåŠ¡ï¼š

```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "cat > /etc/systemd/system/naibao.service << 'EOF'
[Unit]
Description=Naibao Backend Server
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/naibao/backend
ExecStart=/opt/naibao/backend/naibao-server
Restart=always
RestartSec=10
Environment=\"GOPROXY=https://goproxy.cn,direct\"
Environment=\"PATH=/usr/local/go/bin:\$PATH\"

[Install]
WantedBy=multi-user.target
EOF
systemctl daemon-reload
systemctl enable naibao
systemctl start naibao
"
```

---

## ğŸŒ é…ç½®é˜²ç«å¢™ï¼ˆå¦‚æœéœ€è¦å¤–ç½‘è®¿é—®ï¼‰

```bash
ssh -p <SSH_PORT> <SSH_USER>@<SSH_HOST> "ufw allow 8080/tcp && ufw status"
```

---

## âœ… å®ŒæˆçŠ¶æ€

| æ­¥éª¤ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æ­¥éª¤1: é…ç½®ç¯å¢ƒå˜é‡ | âœ… | å·²å®Œæˆ |
| æ­¥éª¤2: å¯åŠ¨åç«¯æœåŠ¡ | âœ… | å·²å®Œæˆ |
| æ­¥éª¤3: æµ‹è¯•æœåŠ¡ | âœ… | å·²å®Œæˆ |

---

## ğŸ‰ æ€»ç»“

**3æ­¥è®¡åˆ’å…¨éƒ¨å®Œæˆï¼**

- âœ… åç«¯æœåŠ¡å·²æˆåŠŸéƒ¨ç½²åˆ°æœåŠ¡å™¨
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… APIæ¥å£æµ‹è¯•é€šè¿‡
- âœ… æœåŠ¡è¿è¡Œç¨³å®š

**ä¸‹ä¸€æ­¥**ï¼šå¯ä»¥å¼€å§‹å‰åç«¯è”è°ƒäº†ï¼ğŸš€

---

## ğŸ“ APIæµ‹è¯•ç¤ºä¾‹

### å¥åº·æ£€æŸ¥
```bash
curl http://<API_HOST>:8080/health
```

### ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST http://<API_HOST>:8080/api/public/register \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456","nickname":"æµ‹è¯•ç”¨æˆ·"}'
```

### ç”¨æˆ·ç™»å½•
```bash
curl -X POST http://<API_HOST>:8080/api/public/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456"}'
```

---

**åç«¯æœåŠ¡éƒ¨ç½²å®Œæˆï¼å¯ä»¥å¼€å§‹å‰åç«¯è”è°ƒï¼** ğŸ‰

