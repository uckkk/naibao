# 设计图实施计划

## 📋 设计图分析

根据提供的5个设计图，需要实现以下页面和功能：

### 1. 喂奶间隔时长和闹钟设置页面
### 2. 宝宝基础资料页面（优化）
### 3. 数据详情页面（新建）
### 4. 主界面/投喂界面（优化）
### 5. 选择奶粉页面（新建）

---

## 🎯 实施计划

### Phase 1: 后端API开发（2-3天）

#### 1.1 喂奶间隔和提醒设置API

**新增数据模型和表**：

**数据库表**（需要在schema.sql中添加）：
```sql
-- 喂奶间隔和提醒设置表
CREATE TABLE feeding_settings (
    id SERIAL PRIMARY KEY,
    baby_id INTEGER NOT NULL REFERENCES babies(id),
    user_id INTEGER NOT NULL REFERENCES users(id),
    day_interval INTEGER DEFAULT 3,        -- 白天间隔（小时）
    night_interval INTEGER DEFAULT 5,      -- 晚上间隔（小时）
    reminder_enabled BOOLEAN DEFAULT true, -- 提醒开关
    advance_minutes INTEGER DEFAULT 15,     -- 提前提醒分钟数
    day_start_hour INTEGER DEFAULT 6,      -- 白天开始时间（默认6点）
    day_end_hour INTEGER DEFAULT 18,       -- 白天结束时间（默认18点）
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(baby_id)
);
```

**Go模型**：
```go
// models/feeding_settings.go
type FeedingSettings struct {
    ID              uint
    BabyID          uint
    UserID          uint
    DayInterval     int    // 白天间隔（小时）
    NightInterval   int    // 晚上间隔（小时）
    ReminderEnabled bool   // 提醒开关
    AdvanceMinutes  int    // 提前提醒分钟数
    DayStartHour    int    // 白天开始时间（默认6点）
    DayEndHour      int    // 白天结束时间（默认18点）
}
```

**API接口**：
- `GET /api/babies/:id/settings` - 获取设置
- `PUT /api/babies/:id/settings` - 更新设置
- `GET /api/babies/:id/next-feeding-time` - 计算下次喂奶时间

#### 1.2 数据统计API（增强）

**新增接口**：
- `GET /api/babies/:id/growth-stats` - 获取生长统计数据
  - 日均增重、日均增高、日均奶量
  - 参考值（卫健委标准）
- `GET /api/babies/:id/daily-records` - 获取每日记录（支持月份筛选）
  - 体重、身高、日总奶量

#### 1.3 奶粉品牌API

**新增接口**：
- `GET /api/formula/brands` - 获取奶粉品牌列表
  - 包含logo、名称、特性、市场份额
- `POST /api/babies/:id/formula` - 选择奶粉
- `GET /api/babies/:id/formula` - 获取当前选择的奶粉

#### 1.4 家庭成员API

**新增接口**：
- `GET /api/babies/:id/family-members` - 获取家庭成员列表
  - 用于主界面显示家庭成员头像

---

### Phase 2: 前端页面开发（4-5天）

#### 2.1 喂奶间隔设置页面（新建）

**文件**：`frontend/src/pages/feeding-settings/index.vue`

**功能**：
- [x] 白天间隔滑动选择器（1-5小时）
- [x] 晚上间隔滑动选择器（3-7小时）
- [x] 下次喂奶时间显示（实时计算）
- [x] 提醒开关（toggle）
- [x] 提前提醒时长滑动选择器（5/10/15/20分钟）
- [x] 保存设置功能

**UI组件**：
- 滑动数字选择器组件（自定义）
- Toggle开关组件

**补充设计**：
- 时间范围说明（白天6点-18点，晚上18点-6点）
- 保存按钮和提示

#### 2.2 宝宝基础资料页面（优化）

**文件**：`frontend/src/pages/baby-info/index.vue`（已存在，需优化）

**优化内容**：
- [x] 优化头像显示（圆形，居中）
- [x] 优化信息展示布局（居中，大字体显示数值）
- [x] 添加编辑功能（点击可编辑）
- [x] 优化日期时间选择器样式

**补充设计**：
- 编辑模式切换
- 保存/取消按钮
- 数据验证

#### 2.3 数据详情页面（新建）

**文件**：`frontend/src/pages/data-detail/index.vue`

**功能**：
- [x] 顶部信息展示（天数、身高、体重）
- [x] 统计卡片（日均增重、增高、奶量，带图标和颜色）
- [x] 参考值显示（卫健委标准，带问号提示）
- [x] 月度数据表格
  - 月份切换（横向滑动）
  - 表格列：日期、体重、身高、日总奶量
  - 数据为空显示 "/"
  - 手动录入的数据高亮显示
- [x] 数据录入功能（点击表格可录入）

**UI组件**：
- 月份切换器组件
- 数据表格组件
- 统计卡片组件

**补充设计**：
- 数据录入弹窗
- 数据编辑功能
- 数据导出功能（可选）

#### 2.4 主界面优化（优化）

**文件**：`frontend/src/pages/home/index.vue`（已落地：首页单一实现，不再维护 `.nvue` 双实现）

**优化内容**：
- [x] 添加家庭成员头像显示（3个小头像）
- [x] 优化喂养时间轴
  - 添加奶粉品牌标识（a2，1，3勺/次）
  - 优化奶瓶图标显示（已填充/未填充）
  - 显示奶量和喂养人头像
- [x] 优化倒计时显示
- [x] 优化投喂按钮样式

**补充设计**：
- 点击时间轴查看详情
- 长按时间轴编辑/删除
- 下拉刷新

#### 2.5 选择奶粉页面（新建）

**文件**：`frontend/src/pages/formula-select/index.vue`

**功能**：
- [x] 奶粉品牌网格列表（3列）
- [x] 品牌卡片显示
  - 圆形logo（带品牌首字）
  - 中文名、英文名
  - 特性标签（最多3个）
  - 市场份额显示
- [x] 选择状态（高亮边框和背景）
- [x] 点击选择功能
- [x] 确认按钮

**UI组件**：
- 奶粉品牌卡片组件

**补充设计**：
- 搜索功能（可选）
- 品牌详情页（可选）
- 选择后返回并更新主界面

---

### Phase 3: 功能补充（2-3天）

#### 3.1 本地通知功能

**功能**：
- 根据设置的间隔和提醒时间，发送本地通知
- 支持提前提醒（5/10/15/20分钟）
- 通知内容：下次喂奶时间

**实现**：
- uni-app本地通知API
- 后台任务（可选）

#### 3.2 数据计算逻辑

**功能**：
- 下次喂奶时间计算（根据最后喂奶时间和间隔设置）
- 日均增重/增高计算（根据生长记录）
- 参考值获取（卫健委标准）

#### 3.3 状态管理

**新增Store**：
- `stores/feeding-settings.ts` - 喂奶设置状态
- `stores/formula.ts` - 奶粉选择状态

---

## 📊 实施顺序

### 第1天：后端API开发
1. 喂奶间隔设置API
2. 数据统计API增强
3. 奶粉品牌API
4. 家庭成员API

### 第2天：前端基础页面
1. 喂奶间隔设置页面
2. 选择奶粉页面

### 第3天：前端复杂页面
1. 数据详情页面（表格和统计）

### 第4天：主界面优化
1. 优化主界面UI
2. 添加家庭成员显示
3. 优化时间轴

### 第5天：功能完善
1. 本地通知功能
2. 数据计算逻辑
3. 状态管理

### 第6天：测试和优化
1. 功能测试
2. UI细节优化
3. 性能优化

---

## 🔧 技术细节补充

### 1. 滑动数字选择器实现

**方案**：使用uni-app的`picker-view`或自定义组件

```vue
<!-- 自定义滑动选择器 -->
<scroll-view class="number-picker" scroll-x>
  <view 
    v-for="num in numbers" 
    :key="num"
    :class="['number-item', { active: num === selectedValue }]"
    @click="selectNumber(num)"
  >
    {{ num }}
  </view>
</scroll-view>
```

### 2. 月份切换器实现

**方案**：横向滚动的月份列表

```vue
<scroll-view class="month-picker" scroll-x>
  <view 
    v-for="month in months" 
    :key="month"
    :class="['month-item', { active: month === selectedMonth }]"
    @click="selectMonth(month)"
  >
    {{ month }}
  </view>
</scroll-view>
```

### 3. 数据表格实现

**方案**：使用`table`组件或自定义表格

```vue
<view class="data-table">
  <view class="table-header">
    <text>日期</text>
    <text>体重 kg</text>
    <text>身高 cm</text>
    <text>日总奶量 ml</text>
  </view>
  <view 
    v-for="record in dailyRecords" 
    :key="record.date"
    class="table-row"
    @click="editRecord(record)"
  >
    <!-- 表格内容 -->
  </view>
</view>
```

### 4. 本地通知实现

**方案**：使用uni-app的`uni.createLocalNotification`

```javascript
// 创建提醒
uni.createLocalNotification({
  content: `下次喂奶时间：${nextFeedingTime}`,
  trigger: {
    date: reminderTime // 提前提醒时间
  }
})
```

---

## 📋 文件清单

### 后端新增文件
- `backend/models/feeding_settings.go` - 喂奶设置模型
- `backend/handlers/feeding_settings.go` - 喂奶设置API
- `backend/handlers/formula.go` - 奶粉品牌API
- `backend/handlers/growth.go` - 生长数据API（增强）

### 前端新增文件
- `frontend/src/pages/feeding-settings/index.vue` - 喂奶间隔设置页
- `frontend/src/pages/data-detail/index.vue` - 数据详情页
- `frontend/src/pages/formula-select/index.vue` - 选择奶粉页
- `frontend/components/number-picker.vue` - 数字选择器组件
- `frontend/components/month-picker.vue` - 月份选择器组件
- `frontend/components/formula-card.vue` - 奶粉品牌卡片组件
- `frontend/components/data-table.vue` - 数据表格组件
- `frontend/stores/feeding-settings.js` - 喂奶设置状态管理
- `frontend/stores/formula.js` - 奶粉选择状态管理

### 前端优化文件
- `frontend/src/pages/home/index.vue` - 主界面优化（单一实现）
- `frontend/src/pages/baby-info/index.vue` - 宝宝资料页优化

---

## ✅ 验收标准

### 功能验收
- [ ] 喂奶间隔设置可以保存和读取
- [ ] 下次喂奶时间计算准确
- [ ] 提醒功能正常工作
- [ ] 数据详情页数据准确
- [ ] 奶粉选择功能正常
- [ ] 主界面显示完整

### UI验收
- [ ] 所有页面UI与设计图一致
- [ ] 交互流畅，无卡顿
- [ ] 数据展示清晰
- [ ] 颜色和字体符合设计

### 性能验收
- [ ] 页面加载速度 < 1秒
- [ ] 数据计算响应 < 100ms
- [ ] 滚动流畅（60fps）

---

## ⚠️ 注意事项

1. **数据验证**：所有用户输入需要验证
2. **错误处理**：API调用失败要有提示
3. **加载状态**：数据加载时显示loading
4. **空状态**：无数据时显示友好提示
5. **兼容性**：确保iOS、Android、小程序都正常

---

## 🎯 预计完成时间

**总计**：6个工作日

- 后端开发：1-2天
- 前端开发：3-4天
- 测试优化：1天

---

**请确认此实施计划，确认后开始实施！** 🚀
