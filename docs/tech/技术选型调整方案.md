# 技术选型调整方案 - 支持iOS/Android/鸿蒙/小程序

## 🔄 技术选型调整

### 原方案 vs 新方案

| 维度 | 原方案（Flutter） | 新方案（uni-app） | 原因 |
|------|------------------|------------------|------|
| iOS | ✅ 支持 | ✅ 支持 | 两者都支持 |
| Android | ✅ 支持 | ✅ 支持 | 两者都支持 |
| 鸿蒙 | ❌ 需要适配 | ✅ **官方支持** | **关键差异** |
| 小程序 | ❌ 不支持 | ✅ **完美支持** | **关键差异** |
| UI体验 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | Flutter稍优，但uni-app足够 |
| 开发效率 | 高 | **非常高** | uni-app一套代码多端运行 |
| 国内生态 | 一般 | **优秀** | uni-app国内文档和社区更好 |

---

## ✅ 最终技术选型：uni-app

### 选择理由

#### 1. **完美支持所有平台**
- ✅ iOS（编译为原生App）
- ✅ Android（编译为原生App）
- ✅ 鸿蒙 HarmonyOS NEXT（官方支持）
- ✅ 微信小程序
- ✅ 支付宝小程序
- ✅ 其他小程序平台

#### 2. **一套代码，多端运行**
- 减少开发成本（无需维护多套代码）
- 统一业务逻辑
- 统一UI规范

#### 3. **国内生态优秀**
- DCloud官方支持（国产框架）
- 中文文档齐全
- 社区活跃，问题解决快
- 符合中国用户使用习惯

#### 4. **UI还原能力强**
- 基于Vue.js，组件丰富
- 支持自定义组件
- 可以完全还原效果图设计
- 支持条件编译，针对不同平台优化

#### 5. **性能表现**
- 小程序端：接近原生性能
- App端：使用nvue（原生渲染）可达到接近原生性能
- 对于纯奶粉喂养工具，性能完全够用

---

## 📦 uni-app 技术栈

### 前端框架
```
uni-app 3.x
├─ 开发语言：Vue 3 + TypeScript
├─ 状态管理：Pinia（推荐）或 Vuex
├─ UI组件库：uni-ui（官方）或 uView Plus
├─ 本地存储：uni.setStorage / uni.getStorage
├─ 网络请求：uni.request
├─ WebSocket：uni.connectSocket
├─ 通知：uni.showNotification
└─ 条件编译：支持平台差异化代码
```

### 后端（保持不变）
```
Go + Gin
├─ Web框架：Gin
├─ WebSocket：gorilla/websocket
├─ 数据库ORM：GORM
└─ 认证：JWT
```

### 数据库（保持不变）
```
腾讯云 TDSQL-C PostgreSQL + Redis
├─ 主数据库：PostgreSQL（托管）
├─ 缓存：Redis
└─ 文件存储：腾讯云COS
```

---

## 🎨 UI还原实现方案

### 1. 页面结构（基于效果图）

#### **页面列表：**
1. `pages/baby-info/index.vue` - 宝宝基础资料
2. `pages/home/index.vue` - 主界面（首页）
3. `pages/formula-select/index.vue` - 选择奶粉
4. `pages/feeding-settings/index.vue` - 喂奶间隔设置
5. `pages/data-detail/index.vue` - 数据详情

#### **组件列表：**
1. `components/baby-avatar.vue` - 宝宝头像（圆形）
2. `components/feeding-timeline.vue` - 喂养时间轴
3. `components/formula-card.vue` - 奶粉品牌卡片
4. `components/amount-selector.vue` - 奶量选择弹窗
5. `components/countdown.vue` - 倒计时组件
6. `components/data-table.vue` - 数据表格

---

### 2. 关键UI还原点

#### **① 圆形头像（带黄色边框）**
```vue
<template>
  <view class="avatar-container">
    <image 
      :src="avatarUrl" 
      class="avatar-circle"
      mode="aspectFill"
    />
  </view>
</template>

<style>
.avatar-container {
  width: 120rpx;
  height: 120rpx;
  border-radius: 50%;
  border: 4rpx solid #FFD700; /* 黄色边框 */
  overflow: hidden;
  background: #FFF9E6; /* 浅黄色背景 */
}
.avatar-circle {
  width: 100%;
  height: 100%;
  border-radius: 50%;
}
</style>
```

#### **② 时间轴（横向滚动）**
```vue
<template>
  <scroll-view class="timeline-container" scroll-x="true">
    <view class="timeline-bar">
      <!-- 奶粉标识 -->
      <view class="formula-badge">...</view>
      <!-- 奶瓶图标列表 -->
      <view 
        v-for="(feeding, index) in feedings" 
        :key="index"
        class="feeding-bottle"
      >
        <image 
          :src="feeding.completed ? bottleActive : bottleInactive"
          class="bottle-icon"
        />
        <text class="amount-text">{{ feeding.amount }}ml</text>
        <image :src="feeding.caregiver.avatar" class="caregiver-avatar" />
      </view>
    </view>
  </scroll-view>
</template>
```

#### **③ 数字选择器（横向滚动）**
```vue
<template>
  <scroll-view class="number-selector" scroll-x="true">
    <view 
      v-for="num in numbers"
      :key="num"
      :class="['number-item', { active: num === selected }]"
      @click="selectNumber(num)"
    >
      <text>{{ num }}</text>
    </view>
  </scroll-view>
</template>

<style>
.number-item {
  padding: 20rpx 30rpx;
  margin: 0 10rpx;
}
.number-item.active text {
  font-weight: bold;
  font-size: 36rpx; /* 选中时放大 */
  color: #000;
}
.number-item:not(.active) text {
  color: #999;
  font-size: 28rpx;
}
</style>
```

#### **④ 数据表格（横向滚动）**
```vue
<template>
  <scroll-view class="table-container" scroll-x="true">
    <view class="table-header">
      <text class="header-cell">日期</text>
      <text class="header-cell">体重 kg</text>
      <text class="header-cell">身高 cm</text>
      <text class="header-cell">日总奶量 ml</text>
    </view>
    <view 
      v-for="(row, index) in tableData"
      :key="index"
      class="table-row"
    >
      <text class="cell">{{ row.date }}</text>
      <text class="cell">{{ row.weight || '/' }}</text>
      <text class="cell">{{ row.height || '/' }}</text>
      <text 
        :class="['cell', { 'highlight': row.milkModified }]"
      >
        {{ row.milk || '/' }}
        <text v-if="row.milkModified" class="modify-icon">+</text>
      </text>
    </view>
  </scroll-view>
</template>
```

---

### 3. 条件编译（平台差异化）

#### **小程序 vs App 差异化代码**
```vue
<template>
  <!-- #ifdef MP-WEIXIN -->
  <!-- 微信小程序特有UI -->
  <view class="wechat-specific">...</view>
  <!-- #endif -->
  
  <!-- #ifdef APP-PLUS -->
  <!-- App特有UI -->
  <view class="app-specific">...</view>
  <!-- #endif -->
  
  <!-- #ifdef HARMONY -->
  <!-- 鸿蒙特有UI -->
  <view class="harmony-specific">...</view>
  <!-- #endif -->
</template>

<script>
export default {
  methods: {
    handleNotification() {
      // #ifdef APP-PLUS
      // App端使用原生通知
      plus.push.createMessage(...);
      // #endif
      
      // #ifdef MP-WEIXIN
      // 小程序端使用模板消息
      wx.requestSubscribeMessage(...);
      // #endif
    }
  }
}
</script>
```

---

## 📋 实施计划调整

### 开发阶段

#### **Phase 1: 基础架构（Week 1-2）**
- [x] 技术选型：uni-app（已确认）
- [ ] uni-app项目初始化
- [ ] 页面结构搭建
- [ ] 组件库引入（uni-ui）

#### **Phase 2: UI还原（Week 3-5）**
- [ ] 按照效果图逐个页面还原
- [ ] 组件开发（头像、时间轴、表格等）
- [ ] 样式还原（颜色、字体、间距）

#### **Phase 3: 功能开发（Week 6-8）**
- [ ] 奶量计算算法集成
- [ ] 数据存储和同步
- [ ] WebSocket实时同步

#### **Phase 4: 多端适配（Week 9-10）**
- [ ] iOS/Android测试
- [ ] 微信小程序测试
- [ ] 鸿蒙适配测试
- [ ] 条件编译优化

---

## ⚠️ 需要注意的技术点

### 1. **性能优化**
- 大量数据使用虚拟列表（vue-virtual-scroll-list）
- 图片使用webp格式，懒加载
- 使用nvue页面提升性能（如需要）

### 2. **小程序限制**
- 小程序包大小限制（主包2M，分包20M）
- 某些API需要用户授权（如通知）
- 网络请求域名需要配置白名单

### 3. **鸿蒙适配**
- HarmonyOS NEXT需要最新版本uni-app
- 某些API可能需要鸿蒙特定实现
- 建议提前测试鸿蒙真机

### 4. **UI还原难点**
- 时间轴横向滚动（需使用scroll-view）
- 数字选择器交互（需自定义实现）
- 表格横向滚动（需使用scroll-view）

---

## ✅ 技术选型确认清单

- [x] 前端：uni-app（支持iOS/Android/鸿蒙/小程序）
- [x] 后端：Go + Gin（保持不变）
- [x] 数据库：腾讯云 TDSQL-C PostgreSQL（保持不变）
- [x] UI还原：严格按照效果图实现
- [x] 优化方案：需确认后实施

---

**文档版本：** v1.0  
**创建时间：** 2025年1月  
**最后更新：** 2025年1月

