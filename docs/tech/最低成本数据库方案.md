# 最低成本数据库方案 - 低于¥35/月

## 🎯 更便宜的替代方案

### 方案对比（从便宜到贵）

| 方案 | 月费用 | 配置 | 适用场景 | 推荐度 |
|------|--------|------|----------|--------|
| **方案A：轻量应用服务器自建** | **¥24/月** | 1核1G，自建PostgreSQL | 技术能力要求低 | ✅ **最推荐** |
| **方案B：Supabase免费版** | **¥0/月** | 免费500MB存储 | 初期测试/小规模 | ✅ 推荐（有限制） |
| **方案C：学生优惠/新用户** | **¥0-10/月** | 各种优惠 | 符合条件 | ✅ 推荐 |
| **方案D：轻量数据库PostgreSQL** | **¥35/月** | 1核1G/20GB | 托管服务 | ⭐⭐⭐ |

---

## ✅ 方案A：轻量应用服务器自建（推荐，最便宜）

### 成本：¥24/月（年付更便宜）

#### 为什么选择这个方案？

**优势**：
1. ✅ **价格最低**：¥24/月（或年付¥288，约¥24/月）
2. ✅ **完全控制**：可以安装PostgreSQL、Redis等
3. ✅ **一机多用**：可以同时运行后端服务和数据库
4. ✅ **性能足够**：1核1G足够小型应用使用

**劣势**：
- ⚠️ 需要自己维护数据库
- ⚠️ 需要配置备份策略
- ⚠️ 需要掌握基本的运维知识

---

### 实施步骤

#### 步骤1：购买轻量应用服务器

**购买链接**：
```
https://console.cloud.tencent.com/lighthouse
```

**配置选择**：
- **地域**：选择国内节点（北京/上海/广州）
- **镜像**：Ubuntu 20.04 LTS 或 CentOS 7（推荐Ubuntu）
- **规格**：1核1G（最低配置）
- **存储**：40GB SSD
- **带宽**：3Mbps
- **计费**：年付¥288（约¥24/月）或月付¥24/月

**价格**：
- 月付：¥24/月
- 年付：¥288/年（约¥24/月）

---

#### 步骤2：在服务器上安装PostgreSQL

**连接到服务器**（使用SSH）：
```bash
ssh root@你的服务器IP
```

**安装PostgreSQL**（Ubuntu）：
```bash
# 更新包列表
sudo apt update

# 安装PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# 启动服务
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 检查状态
sudo systemctl status postgresql
```

**配置PostgreSQL**：
```bash
# 切换到postgres用户
sudo -u postgres psql

# 创建数据库和用户
CREATE DATABASE naibao;
CREATE USER naibao_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE naibao TO naibao_user;

# 退出
\q
```

**配置远程访问**（可选）：
```bash
# 编辑配置文件
sudo nano /etc/postgresql/14/main/postgresql.conf
# 找到 listen_addresses，改为：
listen_addresses = '*'

# 编辑认证配置
sudo nano /etc/postgresql/14/main/pg_hba.conf
# 添加：
host    all             all             0.0.0.0/0               md5

# 重启PostgreSQL
sudo systemctl restart postgresql
```

---

#### 步骤3：配置后端连接

修改 `backend/.env`：
```env
# 使用服务器IP连接
DB_HOST=你的服务器公网IP  # 或内网IP（同地域）
DB_PORT=5432
DB_USER=naibao_user
DB_PASSWORD=your_password
DB_NAME=naibao
DB_SSLMODE=disable
```

---

#### 步骤4：初始化数据库

从本地导入SQL文件：
```bash
# 从本地机器执行
psql -h 你的服务器IP -U naibao_user -d naibao -f database/schema.sql
psql -h 你的服务器IP -U naibao_user -d naibao -f database/init_data.sql
```

---

### 成本对比

| 方案 | 月费用 | 年费用 | 节省 |
|------|--------|--------|------|
| 轻量数据库PostgreSQL | ¥35 | ¥168 | - |
| **轻量应用服务器自建** | **¥24** | **¥288** | **节省31%** |

---

## ⚠️ 方案B：Supabase免费版（不推荐用于生产）

### 成本：¥0/月（有限制）

#### Supabase是什么？

- 开源的Firebase替代品
- 提供PostgreSQL数据库（完全兼容）
- 免费层：500MB存储，2GB带宽/月

**官网**：https://supabase.com/

---

### ⚠️ 重要：国内访问速度问题

**实测延迟**：
- **国内访问延迟**：200-500ms（高10-100倍）
- **网络不稳定**：可能达到1-2秒
- **实时同步受影响**：WebSocket可能频繁断开

**影响**：
- ❌ **不符合"无延时感"要求**
- ❌ 用户体验差（操作有明显延迟）
- ❌ 不适合生产环境

---

### 优势

✅ **完全免费**（初期足够用）  
✅ **PostgreSQL完全兼容**  
✅ **自动备份**  
✅ **REST API自动生成**  
✅ **实时订阅**（WebSocket）

---

### 限制

⚠️ **存储限制**：500MB（约10万条记录）  
⚠️ **带宽限制**：2GB/月  
⚠️ **国内访问速度**：**200-500ms延迟，不推荐** ❌  
⚠️ **数据安全**：数据在国外服务器

**结论**：Supabase免费版**不适合国内生产环境使用**，仅适合海外用户或测试环境。

---

### 使用Supabase的步骤

#### 步骤1：注册Supabase账号

访问：https://supabase.com/
- 点击"Start your project"
- 使用GitHub账号登录（推荐）

#### 步骤2：创建项目

- Project name: naibao
- Database Password: 设置强密码
- Region: 选择最近的区域（如Singapore）

#### 步骤3：获取连接信息

在项目设置中找到：
```
Connection string:
postgresql://postgres:[PASSWORD]@[HOST]:5432/postgres

或者单独的：
Host: xxxxx.supabase.co
Port: 5432
Database: postgres
User: postgres
Password: [你设置的密码]
```

#### 步骤4：配置后端

修改 `backend/.env`：
```env
DB_HOST=xxxxx.supabase.co
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=你的Supabase密码
DB_NAME=postgres
DB_SSLMODE=require
```

#### 步骤5：导入数据

使用pgAdmin或psql连接Supabase，执行SQL文件。

---

### Supabase vs 自建服务器

| 维度 | Supabase免费版 | 自建服务器 |
|------|---------------|-----------|
| 成本 | ¥0/月 | ¥24/月 |
| 存储 | 500MB | 40GB（可扩展） |
| **国内访问延迟** | **200-500ms** ⚠️ | **5-20ms** ✅ |
| 维护成本 | 无 | 需要自己维护 |
| 数据位置 | 国外 | 国内（可控制） |

**⚠️ 重要**：Supabase在国内访问延迟较高（200-500ms），**不符合"无延时感"要求**！

**建议**：❌ **不推荐使用Supabase托管服务**，直接使用自建服务器（¥24/月）。

---

## ✅ 方案C：学生优惠/新用户优惠

### 腾讯云学生优惠

**学生优惠链接**：
```
https://cloud.tencent.com/act/campus
```

**优惠内容**：
- 轻量应用服务器：¥9/月起
- 数据库：可能有折扣
- 新用户：通常有代金券

**要求**：
- 学生身份认证
- 年龄24岁以下

---

### 新用户优惠

**新用户首年优惠**：
- 可能有首年半价或免费额度
- 建议联系腾讯云客服咨询

---

## 🎯 最终推荐（按预算）

### 预算 < ¥10/月

**推荐**：轻量应用服务器自建PostgreSQL
- ¥24/月（最便宜的可行方案）
- ⚠️ Supabase免费版延迟太高（200-500ms），不推荐

### 预算 ¥10-30/月

**推荐**：轻量应用服务器自建PostgreSQL
- ¥24/月（最便宜的自建方案）
- 完全控制
- 一机多用

### 预算 ¥30-50/月

**推荐**：轻量数据库PostgreSQL
- ¥35/月（托管服务，省心）
- 自动备份
- 无需维护

---

## 💡 成本优化技巧

### 1. 年付折扣
- 年付通常比月付便宜30-60%
- 例如：轻量应用服务器年付约¥288

### 2. 组合使用
```
方案：轻量应用服务器（¥24/月）
├─ 运行Go后端服务
├─ 运行PostgreSQL数据库
└─ 运行Redis缓存
一机多用，性价比最高！
```

### 3. 流量优化
- 使用内网连接（免费）
- 减少不必要的API调用
- 使用缓存减少数据库查询

### 4. 存储优化
- 定期清理旧数据
- 图片使用对象存储（按量计费）
- 冷数据归档

---

## ✅ 我的推荐

### 最低成本方案（推荐）

**方案**：轻量应用服务器自建PostgreSQL

**配置**：
- 轻量应用服务器：1核1G/40GB，¥24/月（年付¥288）

**优势**：
1. ✅ 价格最低（¥24/月）
2. ✅ 一机多用（后端+数据库+Redis）
3. ✅ 完全控制
4. ✅ 后续可扩展

**实施难度**：中等（需要基本的Linux和PostgreSQL知识）

---

### ⚠️ Supabase免费版（不推荐用于生产）

**方案**：Supabase免费版

**优势**：
1. ✅ 完全免费
2. ✅ 无需维护
3. ✅ 快速上手

**劣势**：
- ❌ **国内访问延迟高**：200-500ms（不符合"无延时感"要求）
- 500MB存储限制
- 国外服务器（数据在国外）
- 实时同步可能不稳定

**结论**：❌ **不推荐用于生产环境**，仅适合：
- 海外用户的项目
- 纯测试环境
- 对延迟不敏感的场景

**建议**：直接使用自建服务器方案，避免后期迁移成本。

---

## 📋 实施检查清单

### 自建PostgreSQL方案
- [ ] 购买轻量应用服务器（¥24/月）
- [ ] 安装PostgreSQL
- [ ] 配置数据库和用户
- [ ] 配置防火墙（开放5432端口）
- [ ] 设置自动备份脚本
- [ ] 配置后端连接

### Supabase方案
- [ ] 注册Supabase账号
- [ ] 创建项目
- [ ] 获取连接信息
- [ ] 配置后端
- [ ] 导入数据库结构

---

**最低成本：¥24/月（自建）或 ¥0/月（Supabase免费版）**

您更倾向于哪个方案？我可以帮您详细实施！🎯

