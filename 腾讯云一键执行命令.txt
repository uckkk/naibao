# è…¾è®¯äº‘ Cloud Shell ä¸€é”®æ‰§è¡Œå‘½ä»¤
# ç›´æ¥å¤åˆ¶ä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨è…¾è®¯äº‘æ§åˆ¶å°çš„ Cloud Shell ä¸­ç²˜è´´æ‰§è¡Œ

# ==========================================
# æ–¹æ³•1ï¼šä¸€é”®æ‰§è¡Œï¼ˆæ¨èï¼‰
# ==========================================
# å¤åˆ¶ä¸‹é¢çš„æ•´æ®µä»£ç ï¼Œåœ¨ Cloud Shell ä¸­ç²˜è´´å¹¶å›è½¦

cd /opt/naibao/backend && \
./stop_server.sh && \
sed -i 's/Access-Control-Allow-Credentials", "true"/Access-Control-Allow-Credentials", "false"/' router/middleware/cors.go && \
export PATH=$PATH:/usr/local/go/bin && \
export GOPROXY=https://goproxy.cn,direct && \
go build -o naibao-server main.go && \
./start_server.sh && \
sleep 2 && \
curl -s http://127.0.0.1:8080/health && \
echo "" && \
echo "âœ… ä¿®å¤å®Œæˆï¼" && \
echo "ğŸ“‹ è¯·æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾8080ç«¯å£"

# ==========================================
# æ–¹æ³•2ï¼šä½¿ç”¨è„šæœ¬æ–‡ä»¶ï¼ˆå¦‚æœæ–¹æ³•1å¤±è´¥ï¼‰
# ==========================================
# 1. å…ˆä¸Šä¼  è…¾è®¯äº‘ä¸€é”®ä¿®å¤.sh åˆ°æœåŠ¡å™¨
# 2. ç„¶åæ‰§è¡Œï¼š
# chmod +x /opt/naibao/backend/è…¾è®¯äº‘ä¸€é”®ä¿®å¤.sh
# /opt/naibao/backend/è…¾è®¯äº‘ä¸€é”®ä¿®å¤.sh

# ==========================================
# éªŒè¯å‘½ä»¤ï¼ˆä¿®å¤åæ‰§è¡Œï¼‰
# ==========================================
# æ£€æŸ¥CORSé…ç½®ï¼š
curl -I http://127.0.0.1:8080/health | grep -i "access-control"

# æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š
ps aux | grep naibao-server | grep -v grep

# æ£€æŸ¥ç«¯å£ç›‘å¬ï¼š
netstat -tlnp | grep 8080

# æŸ¥çœ‹æ—¥å¿—ï¼š
tail -20 /opt/naibao/backend/server.log


